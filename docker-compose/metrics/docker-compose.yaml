version: '3'
services:
  graphite-statsd:
    image: graphiteapp/graphite-statsd:1.1.7-6
    container_name: graphite
    hostname: graphite-statsd
    restart: always
    ports:
        - "80:80"
        - "8125:8125/udp"
  prometheus:
    image: prom/prometheus:v2.20.1
    container_name: prometheus
    hostname: prometheus
    restart: always
    volumes:
      - ./prometheus:/etc/prometheus
    ports:
      - "9090:9090"
  spire-server:
    # image: gcr.io/spiffe-io/spire-server:0.11.0
    image: gcr.io/spiffe-io/spire-server@sha256:818c3e3ae7e1e576c08c7f685bcc3d538c7130c272516b4e4653b7115460e64b
    hostname: spire-server
    volumes:
        - ./spire/server:/opt/spire/conf/server
    command: ["-config", "/opt/spire/conf/server/server.conf"]
  spire-agent:
    image: gcr.io/spiffe-io/spire-agent@sha256:e93e6879cc2a231a4983444312d8c32523c1106f388df275dca0db484cca312f
    depends_on: ["spire-server"]
    hostname: spire-agent
    volumes:
        - ./spire/agent:/opt/spire/conf/agent
        - /var/run/:/var/run/
    command: ["-config", "/opt/spire/conf/agent/agent.conf"]
